<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    <link rel="stylesheet" type="text/css" href="/assets/fonts/font/flaticon_veritatrust.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/style.css">
    
    <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
    https://firebase.google.com/docs/web/setup#config-web-app -->
    <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js" defer ></script>
    <title>Veritatrust</title>
    <script src="js/NoteCommentReview.js" type="module"></script>
    <script src="js/review.js" type="module" defer></script>
   
    
    <style>
      .star-default {
        border-radius: 50%;
        width: 3rem;
        height: 3rem;
        background-size: cover;
        cursor: pointer;
      }
      .star-empty {
        background-image: url('img/star-0.png');
      }
      .star-filled {
        background-image: url('img/star-1.png');
      }
    </style>
</head>

<body class="merchant">
    <nav class="navbar sticky-top navbar-white bg-white navbar-dark navbar-expand-lg shadow-sm">
         <div class="container" id = "container-menu">
            <a class="navbar-brand" href="/">
                <img src="/assets/img/logo-veritatrust-c.png" alt="Veritatrust" width="170">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <form class="d-flex w-lg-50 search my-3 my-lg-0" role="search">
                    <input class="form-control" placeholder="Rechercher un produit ou service">
                </form>
                <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active align-self-center" aria-current="page" href="./">Explore</a>
                        <ul class="submenu dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#"><i class="flaticon flaticon-user"></i> Domaine name</a></li>
                            <li><a class="dropdown-item" href="#"><i class="flaticon flaticon-user"></i> Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#"><i class="flaticon flaticon-user"></i> Something else here</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link  align-self-center" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Resources
                    </a>

                    </li>
                    <li class="nav-item">
                        <a class="nav-link align-self-center" href="#">Blog</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link align-self-center" href="#">Create</a>
                    </li>
                    <li class="nav-item"><a class="nav-link align-self-center" type="button" data-bs-toggle="offcanvas" data-bs-target="#account" aria-controls="account"><i class="flaticon flaticon-user"></i></a></li>
                </ul>

            </div>



        </div>
    </nav>
    <div class="offcanvas offcanvas-end text-bg-primary" data-bs-scroll="true" tabindex="-1" id="account" aria-labelledby="offcanvasWithBothOptionsLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Your account</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        
        <div class="d-none" id="error-message-2">
                                    <div class="me-3"><i class="flaticon-information"></i></div>
                                    <div>Error message</div>
        </div>
        
        <div class="offcanvas-body">
            <!-- if not logued / login form -->
            <p>Enter your login and password</p>
            <form action="" id="login">
                <div class="mb-3">
                    <input type="email" class="form-control" id="usermail" aria-describedby="emailHelp" title="User Email" placeholder="User Email">
                    <div id="emailHelp" class="form-text text-white">We'll never share your email with anyone else.</div>
                </div>
                <div class="mb-3">
                    <input type="password" class="form-control" id="userpassword" title="Password" placeholder="Password">
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="rememberme" checked="">
                    <label class="form-check-label" for="rememberme">Stay connected</label>
                </div>
                
            </form>
            <button type="submit" class="btn btn-success" onclick="emailPasswordLogin()" id="userbutton">Login</button>
            <hr>
            <p class="mt-3 mb-1">You haven't again an account ?</p>
            <button type="submit" class="btn btn-light" onclick="emailPasswordSignin()">Create my account</button>
            <!-- end if not logued / login form -->
           
            
        </div>
    </div>
    <section class="py-5 form">
        <div class="container">
  
            <div class="row d-flex align-items-center">
                <div class="col-11 col-lg-8 pt-3 mx-auto text-center">
                    <h3>Rate your experience <span><%=merchant%></span></h3>
                    <p>Share your opinion and get reward!</p>
                </div>
                <div class="col-11 col-lg-8 py-4 px-lg-4 mx-auto bg-light rounded-5">
                    <div class="form__header">
                        <div class="row d-flex align-items-center">
                            <div class="col-8 col-md-4 col-xl-3 d-flex rounded-4 border bg-white visuel-mark logo mx-auto">
                                <img class="align-self-center m-0" src="https://store.fatasoft-consulting.com/wp-content/uploads/2022/07/cropped-icon-1.png" alt="Merchant name">
                            </div>
                            <div class="col-12 col-md-8 col-xl-9">
                                <div class="form__header__note">
                                    <p class="lead">Rate your experience</p>
                                        <div class="form__star mb-3 d-flex justify-content-start" id="review"
                                      data-review="merchand"
                                      data-selected="1">
                                      <div class="star-review star-default star-empty" data-index="1"></div>
                                      <div class="star-review star-default star-empty" data-index="2"></div>
                                      <div class="star-review star-default star-empty" data-index="3"></div>
                                      <div class="star-review star-default star-empty" data-index="4"></div>
                                      <div class="star-review star-default star-empty" data-index="5"></div>
                                        
                                    </div>
                                
                                    <p><span id="review-value">1 </span> <span id="review-value-text"> <strong> star: </strong>very bad </span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="form__content">
                        <p class="lead mt-3 mb-0">Write your title</p>
                        <input class="form-control" type="text" id = "title">
                        <p class="lead mb-0">Write your review</p>
                        <p id="note_review" class="">Your review content: <span id="note-review" class="bad">Bad</span> </p>
                        <textarea class="form-control" name="" id="content" rows="10" placeholder="Share your opinion here. Talk about your experience without using offensive language. Leave an honest, useful and constructive testimonial."></textarea>
                        <p class="lead mt-3 mbnput cla-0">Experience date</p>
                        
                        <!-- max = var pour la date du lendemain -->
                         <input class="form-control" type="date" max="<%= new Date().toISOString().split("T")[0] %>" data-date-inline-picker="true" value="<%= new Date().toISOString().split("T")[0] %>" name="date" id="date" required>
                        <!-- max = var pour la date du lendemain -->
                    </div>
                    <!-- à masquer par defaut avec un 'd-none' ou en js-->
                    <div class="d-none">
                        Message d'erreur
                    </div>
                    <div class="form__footer">
                    
                      <div class="row d-flex align-items-center">  
                        <div class="container" id="root-submit">
                        <div class="row d-flex align-items-center">
                            <div class="col-11 col-lg-8 pt-3 mx-auto text-center">
                                <h3>Submit the review</h3>
                            </div>
                            <div class="col-11 col-lg-8 py-4 px-lg-6 mx-auto">
                                <div class="form__account">
                                    <div class="row d-flex flex-column align-items-center">
                                        <div class="col-12 col-md-6 d-flex flex-column mx-auto gap-2" id="module-connect">
                                            <button class="btn btn-primary" onclick="facebookSignin()">Sign in with Facebook</button>
                                            <button class="btn btn-primary" onclick="googleSignin()">Sign in with Google</button>
                                            <button  class="btn btn-primary" id="metaloginbtn">Sign in with Metamask</button>
                                           
                                            <a href="#" class="d-none">Continuer avec Apple</a>
                                        </div>
                                        <div class="d-none">
                                            <div class="orbymail text-center">
                                                <div class="separator">with email and password</div>
                                            </div>
                                        </div>
                                           
                                           <div class="row d-flex align-items-center" id="sumbit-email">
                                                    <!-- if not logued / login form -->
                                                    <p id="msg">Enter your login and password</p>
                                                    <form action="" id = "login">
                                                        <div class="mb-3">
                                                            <input type="email" class="form-control" id="email" aria-describedby="emailHelp" title="User Email" placeholder="User Email">
                                                        </div>
                                                        <div class="mb-3">
                                                            <input type="password" class="form-control" id="password" title="Password" placeholder="Password">
                                                        </div>
                                                     
                                                        
                                                    </form>
                                                    <div col-12 col-md-6 d-flex flex-column mx-auto gap-2 >
                                                    <button class="btn btn-primary" onclick = "emailPasswordLogin()">Login</button>
                                                    <hr>
                                                    <p class="mt-3 mb-1" id="msg1">You haven't again an account ?</p>
                                                    <button  class="btn btn-primary" onclick="emailPasswordSignin()">Create my account</button>
                                                    <!-- end if not logued / login form -->
                                                    </div>
                                                    

                                                    
                                                    
                                                  
                                                    
                                                    <div class="d-none" id="message-confirm">
                                                        <div class="me-3"><i class="flaticon-check"></i></div>
                                                        <div>Success Message</div>
                                                    </div>
                                                   
                                                </div>
                                                
                                                     
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                <hr>
            
            
                            </div>
                            
                                    <div class ="col-12 col-md-6 d-flex flex-column mx-auto gap-2" id="publish">
                                            <button class="btn btn-primary" onclick = "publishing()">Publish</button>
                                            
                                     </div>
                        </div>
                    </div>
                 </div>
                </div>
            </div>
        
        <script src="/js/class-veritatrust.js" type="module" defer></script>
        
       <!--  <script src = '/js/authentificator.js'></script>  -->
         <script src = '/js/evaluateservice.js'></script>
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
          
          <script>
                              // Create global userWalletAddress variable
                window.userWalletAddress = null;
                
                // when the browser is ready
                window.onload = async (event) => {
                  // check if ethereum extension is installed
                  if (window.ethereum) {
                    // create web3 instance
                    window.web3 = new Web3(window.ethereum);
                  } else {
                    // prompt user to install Metamask
                    alert("Please install MetaMask or any Ethereum Extension Wallet");
                  }
                
                  // check if user is already logged in and update the global userWalletAddress variable
                  window.userWalletAddress = window.localStorage.getItem("userWalletAddress");
                
                  // show the user dashboard
                  showUserDashboard();
                };
                
                // Web3 login function
                const loginWithEth = async () => {
                  // check if there is global window.web3 instance
                  if (window.web3) {
                    try {
                      // get the user's ethereum account - prompts metamask to login
                      const selectedAccount = await window.ethereum
                        .request({
                          method: "eth_requestAccounts",
                        })
                        .then((accounts) => accounts[0])
                        .catch(() => {
                          // if the user cancels the login prompt
                          throw Error("Please select an account");
                        });
                
                      // set the global userWalletAddress variable to selected account
                      window.userWalletAddress = selectedAccount;
                
                      // store the user's wallet address in local storage
                      window.localStorage.setItem("userWalletAddress", selectedAccount);
                
                      // show the user dashboard
                      
                      document.cookie = 'userWalletAddress=' + selectedAccount + ";expires=Fri, 31 Dec 2022 12:00:00 UTC; path=/" ;
                       
                        axios.post("https://dev.veritatrust.com/sessionandevaluate", {
                            
                          idToken: "",
                          idWallet: window.userWalletAddress,
                          title: document.getElementById("title").value,
                          content: document.getElementById("content").value,
                          rating: parseInt(document.getElementById("review-value").innerHTML),
                          experience_date: document.getElementById("date").value.toString() + ' 00:00:00',
                          email: window.userWalletAddress+"@gmail.com"
                    
                       })
                       .then(res => {
                             
                           /* var message = document.getElementById("message-confirm");
                            message.className = "callout callout-primary d-flex";
                            message.innerHTML = "Review registred with success <a href='https://dev.veritatrust.com/org-review?site=www.fatasoft-consulting.com' target='_blank'>View </a> "; 
                            */
                            if(res.data == "profile")
                            
                                        window.location.assign('/user-dashboard');
                            else 
                                        window.location.assign('/update_account');
                           
                            
                       }); 
                   
                    } catch (error) {
                      alert(error);
                    }
                  } else {
                    alert("wallet not found");
                  }
                };
                
                // function to show the user dashboard
                const showUserDashboard = async () => {
                  // if the user is not logged in - userWalletAddress is null
                  if (!window.userWalletAddress) {
                    // change the page title
                    document.title = "Web3 Login";
                
                    // show the login section
                    document.querySelector(".login-section").style.display = "flex";
                
                    // hide the user dashboard section
                    document.querySelector(".dashboard-section").style.display = "none";
                
                    // return from the function
                    return false;
                  }
                  
                  
                
                
                  // change the page title
                  document.title = "Web3 Dashboard  🤝";
                
                  // hide the login section
                  document.querySelector(".login-section").style.display = "none";
                
                  // show the dashboard section
                  document.querySelector(".dashboard-section").style.display = "flex";
                
                  // show the user's wallet address
                  showUserWalletAddress();
                
                  // get the user's wallet balance
                  getWalletBalance();
                };
                
                // show the user's wallet address from the global userWalletAddress variable
                const showUserWalletAddress = () => {
                  const walletAddressEl = document.querySelector(".wallet-address");
                  walletAddressEl.innerHTML = window.userWalletAddress;
                };
                
                // get the user's wallet balance
                const getWalletBalance = async () => {
                  // check if there is global userWalletAddress variable
                  if (!window.userWalletAddress) {
                    return false;
                  }
                
                  // get the user's wallet balance
                  const balance = await window.web3.eth.getBalance(window.userWalletAddress);
                
                  // convert the balance to ether
                  document.querySelector(".wallet-balance").innerHTML = web3.utils.fromWei(
                    balance,
                    "ether"
                  );
                };
                
                // web3 logout function
                const logout = () => {
                  // set the global userWalletAddress variable to null
                  window.userWalletAddress = null;
                
                  // remove the user's wallet address from local storage
                  window.localStorage.removeItem("userWalletAddress");
                
                  // show the user dashboard
                  showUserDashboard();
                };
                
                window.onload=function() {
                   // when the user clicks the login button run the loginWithEth function
                document.querySelector("#metaloginbtn").addEventListener("click", loginWithEth);
                
                // when the user clicks the logout button run the logout function
                document.querySelector(".logout-btn").addEventListener("click", logout);
                }

          
          </script>
          <script>
          function getCookie(name) {
                    var dc = document.cookie;
                    var prefix = name + "=";
                    var begin = dc.indexOf("; " + prefix);
                    if (begin == -1) {
                        begin = dc.indexOf(prefix);
                        if (begin != 0) return null;
                    }
                    else
                    {
                        begin += 2;
                        var end = document.cookie.indexOf(";", begin);
                        if (end == -1) {
                        end = dc.length;
                        }
                    }
                    // because unescape has been deprecated, replaced with decodeURI
                    //return unescape(dc.substring(begin + prefix.length, end));
                    return decodeURI(dc.substring(begin + prefix.length, end));
                } 
          
          // Tester si l'utilisateur est deja sous session
          
           if(getCookie("userWalletAddress") == null && getCookie("session") == null)
             {
                    document.getElementById("root-submit").className = "container"; 
                    document.getElementById("publish").className = "d-none"; 
                    console.log("not connected");
                    console.log(getCookie("userWalletAddress"));
                    console.log(getCookie("session"));
                    
                    
             }
              
             else
             
             {
                    document.getElementById("root-submit").className = "d-none";
                     document.getElementById("publish").className = "col-12 col-md-6 d-flex flex-column mx-auto gap-2"; 
                    console.log("connected");
                    console.log(getCookie("userWalletAddress"));
                    console.log(getCookie("session"));
             }
             
        
          </script>

    </section>

    <footer class="bg-primary py-2 text-white">
        <div class="container">
            <div class="text-center">
                <p class=" mb-0">© 2022 - All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>    
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/custom.js"></script>
     <script src="/js/metaconnect2.js"></script>
    <script src="js/NoteCommentReview.js"></script>
    
</body>

</html>